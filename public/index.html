<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Ruslan Chat ‚Äî –∞–Ω–æ–Ω–∏–º–Ω—ã–π —á–∞—Ç</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" type="image/x-icon" href="favicon.ico">

<style>
/* –¢–ï–ú–´ */
:root {
    --bg: #000;
    --text: #0f0;
    --panel-bg: rgba(0,255,50,0.06);
    --msg-bg: #1d1f23;
    --input-bg: #222;
    --logo-bg: #00ff91;
}
.light {
    --bg: #f2f2f2;
    --text: #000;
    --panel-bg: #fff;
    --msg-bg: #e6e6e6;
    --input-bg: #fff;
    --logo-bg: #00c86d;
}

body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: var(--bg);
    color: var(--text);
    transition: .3s;
}

/* –ù–ï–û–ù */
.glow {
    text-shadow: 0 0 10px #00ff91, 0 0 20px #00ff91, 0 0 40px #00ff91;
}

/* –®–ê–ü–ö–ê */
#header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 25px;
    font-size: 26px;
    font-weight: bold;
}
#logo {
    background: var(--logo-bg);
    color: #000;
    padding: 7px 14px;
    border-radius: 12px;
    font-weight: bold;
    box-shadow: 0 0 20px var(--logo-bg);
}

#themeBtn {
    padding: 10px 15px;
    background: var(--logo-bg);
    border: none;
    border-radius: 10px;
    cursor: pointer;
    box-shadow: 0 0 18px var(--logo-bg);
}

/* –ì–õ–ê–í–ù–ê–Ø –ü–ê–ù–ï–õ–¨ */
#panel {
    width: 70%;
    margin: 20px auto;
    padding: 25px;
    border-radius: 20px;
    background: var(--panel-bg);
    box-shadow: 0 0 25px #00ff91;
}

label { margin-bottom: 5px; font-size: 18px; display: block; }

select {
    width: 180px;
    padding: 10px;
    border-radius: 8px;
    border: none;
}

/* –ö–ù–û–ü–ö–ò */
#findBtn, #shareBtn {
    width: 100%;
    padding: 18px;
    margin-top: 20px;
    font-size: 18px;
    font-weight: bold;
    background: #00ff66;
    border-radius: 12px;
    border: none;
    cursor: pointer;
    box-shadow: 0 0 20px #00ff91;
}

#findBtn:hover, #shareBtn:hover { transform: scale(1.03); }

#stopSearch {
    display: none;
    width: 100%;
    padding: 14px;
    background: #ff3b3b;
    border-radius: 10px;
    border: none;
    color: white;
    margin-top: 15px;
}

/* –°–ü–ò–ù–ù–ï–† */
#spinner {
    display: none;
    margin: 15px auto;
    width: 50px;
    height: 50px;
    border: 6px solid #333;
    border-top: 6px solid #00ff91;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    100% { transform: rotate(360deg); }
}

/* –ß–ê–¢ */
#chat {
    display: none;
    width: 70%;
    margin: 20px auto;
}

#messages {
    background: #0d0f12;
    height: 430px;
    overflow-y: auto;
    padding: 20px;
    border-radius: 16px;
    box-shadow: 0 0 25px #00ff91;
}

/* –í–ê–ñ–ù–û: –ø–µ—Ä–µ–Ω–æ—Å */
.msg {
    background: var(--msg-bg);
    color: var(--text);
    padding: 12px 16px;
    border-radius: 14px;
    margin-bottom: 10px;
    max-width: 100%;
    animation: fade .25s ease;
    position: relative;
    word-wrap: break-word;
    white-space: pre-wrap;
    box-sizing: border-box;
}

@keyframes fade {
    from {opacity: 0; transform: translateY(10px);}
    to {opacity: 1;}
}

#typing {
    height: 22px;
    font-size: 15px;
    color: #00ff91;
    display: flex;
    align-items: center;
    gap: 8px;
}

/* typing dots */
.typing-dots { display:inline-flex; gap:8px; align-items:center; }
.dot { width:10px; height:10px; background:#00ff91; border-radius:50%; animation:dot-jump 1s infinite; }

@keyframes dot-jump {
  0%{ transform:translateY(0); opacity:.35 }
  35%{ transform:translateY(-6px); opacity:1 }
  70%{ transform:translateY(0); opacity:.6 }
  100%{ transform:translateY(0); opacity:.35 }
}

/* send panel */
#sendPanel {
    display:flex;
    margin-top:10px;
    gap:10px;
    align-items:center;
}

#msgInput {
    flex:1;
    padding:12px;
    border-radius:12px;
    border:none;
    background:var(--input-bg);
    color:var(--text);
}

#sendBtn {
    padding:12px 25px;
    background:#00ff91;
    border-radius:10px;
    border:none;
    cursor:pointer;
}

/* üé§ –ö–ù–û–ü–ö–ê –ì–û–õ–û–°–û–í–´–• */
#voiceBtn {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    border: none;
    background: #00ff91;
    color: black;
    font-size: 22px;
    cursor: pointer;
    box-shadow: 0 0 14px #00ff91;
}

#voiceBtn.recording {
    background: #ff3b3b;
    box-shadow: 0 0 20px #ff3b3b;
}

#endBtn {
    margin-top:15px;
    width:100%;
    padding:14px;
    background:#ff3b3b;
    color:white;
    border:none;
    border-radius:10px;
    display:none;
}

/* –†–µ–∞–∫—Ü–∏–∏ ‚Äî —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –º–µ–Ω—é */
.reaction-menu {
    position: fixed;
    bottom: 70px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0,255,80,0.12);
    border: 1px solid #00ff91;
    padding: 8px 10px;
    border-radius: 12px;
    display: none;
    gap: 8px;
    box-shadow: 0 0 18px #00ff91;
    z-index: 2000;
}

.reaction { cursor:pointer; font-size:22px; padding:6px; background:rgba(0,0,0,0.18); border-radius:8px; }
.reaction:hover { transform: scale(1.15); }

.msg-react {
    font-size:18px;
    margin-left:8px;
    opacity:.95;
    position:absolute;
    right:10px;
    top:10px;
}
</style>

<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
</head>
<body>

<!-- –§–ê–ö–¢ –î–ù–Ø -->
<div id="factBox">
  <div id="factClose">‚úñ</div>
  <h3 style="text-align:center;margin-top:5px;color:#00ff91;" class="glow">–§–∞–∫—Ç –¥–Ω—è</h3>
  <p id="factText"></p>
</div>

<div id="header">
  <div style="display:flex;align-items:center;gap:12px;">
    <div id="logo">RC</div>
    <span class="glow">Ruslan Chat</span>
  </div>
  <button id="themeBtn">–¢—ë–º–Ω–∞—è —Ç–µ–º–∞</button>
</div>

<div style="text-align:center; margin-top:5px; font-size:18px;" class="glow">
  9 –∏–∑ 10 –Ω–∞—Ö–æ–¥—è—Ç –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–≥–æ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞ –∑–∞ 5 —Å–µ–∫—É–Ω–¥
</div>

<!-- –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ -->
<div id="panel">
  <div style="font-size:18px;">–û–Ω–ª–∞–π–Ω: <span id="online">0</span></div><br>

  <label>–í–∞—à –ø–æ–ª:</label>
  <select id="gender">
    <option>–ú—É–∂—á–∏–Ω–∞</option>
    <option>–ñ–µ–Ω—â–∏–Ω–∞</option>
  </select>

  <label style="margin-top:15px;">–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–π –ø–æ–ª:</label>
  <select id="searchfor">
    <option>–ò—â—É –ª—é–±–æ–π</option>
    <option>–ò—â—É –º—É–∂—á–∏–Ω—É</option>
    <option>–ò—â—É –∂–µ–Ω—â–∏–Ω—É</option>
  </select>

  <button id="findBtn">–ù–ê–ô–¢–ò –°–û–ë–ï–°–ï–î–ù–ò–ö–ê</button>
  <div id="spinner"></div>
  <button id="stopSearch">–ü–†–ï–ö–†–ê–¢–ò–¢–¨ –ü–û–ò–°–ö</button>

  <button id="shareBtn">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å–∞–π—Ç–æ–º</button>
</div>

<!-- –ß–ê–¢ -->
<div id="chat">
  <div id="partnerStatus" style="text-align:center;color:#00ff91;margin-bottom:8px;"></div>

  <div id="messages"></div>
  <div id="typing"></div>

  <div id="sendPanel">
    <input id="msgInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." autocomplete="off"/>
    <button id="voiceBtn">üé§</button>
    <button id="sendBtn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
  </div>

  <button id="endBtn">–ó–∞–≤–µ—Ä—à–∏—Ç—å —á–∞—Ç</button>
</div>

<!-- –ú–ï–ù–Æ –†–ï–ê–ö–¶–ò–ô -->
<div id="reactionMenu" class="reaction-menu">
  <div class="reaction">‚ù§Ô∏è</div>
  <div class="reaction">üòÇ</div>
  <div class="reaction">üëç</div>
  <div class="reaction">üí©</div>
  <div class="reaction">‚ùó</div>
  <div class="reaction">üò°</div>
  <div class="reaction">üò≠</div>
  <div class="reaction">üò±</div>
</div>

<!-- –†–ï–ô–¢–ò–ù–ì -->
<div id="ratingBox">
  <div class="title">‚≠ê –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞?</div>
  <div class="desc">
    –ö–∞–∂–¥—ã–π –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–π —á–∞—Ç –ø–æ–≤—ã—à–∞–µ—Ç –≤–∞—à —É—Ä–æ–≤–µ–Ω—å.  
    –í–∞—à —Å—Ç–∞—Ç—É—Å –≤–∏–¥—è—Ç –¥—Ä—É–≥–∏–µ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏.
  </div>
  <div class="levels">
    <div class="level">üü¢ –ù–æ–≤–∏—á–æ–∫ ‚Äî 0‚Äì49</div>
    <div class="level">üîµ –•–æ—Ä–æ—à–∏–π ‚Äî 50‚Äì299</div>
    <div class="level">üü£ –û–ø—ã—Ç–Ω—ã–π ‚Äî 300‚Äì699</div>
    <div class="level">üëë –ü–æ–ø—É–ª—è—Ä–Ω—ã–π ‚Äî 700‚Äì1199</div>
    <div class="level">üëëüëë –ö–û–†–û–õ–¨ ‚Äî 1200+</div>
  </div>
  <div id="ratingYou" class="you"></div>
</div>

<script>
/* –ö–õ–ò–ï–ù–¢ */
const socket = io();

/* –§–ê–ö–¢ –î–ù–Ø */
const facts = [
  "–í —Å—Ä–µ–¥–Ω–µ–º —á–µ–ª–æ–≤–µ–∫ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –Ω–µ–∑–Ω–∞–∫–æ–º—Ü—É –≤ 2 —Ä–∞–∑–∞ –±—ã—Å—Ç—Ä–µ–µ.",
  "–ö–∞–∂–¥—ã–π —Ç—Ä–µ—Ç–∏–π –Ω–∞—á–∏–Ω–∞–µ—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä —Å —á–µ–ª–æ–≤–µ–∫–æ–º, –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–∏–∫–æ–≥–¥–∞ –±—ã –Ω–µ –≤—ã–±—Ä–∞–ª –≤ —Ä–µ–∞–ª—å–Ω–æ–π –∂–∏–∑–Ω–∏.",
  "–°–∞–º–æ–µ –∫–æ—Ä–æ—Ç–∫–æ–µ –æ–±—â–µ–Ω–∏–µ –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å —Å–∞–º—ã–º –∑–∞–ø–æ–º–∏–Ω–∞—é—â–∏–º—Å—è.",
  "–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ª—é–¥–µ–π –±–æ—è—Ç—Å—è –Ω–∞—á–∏–Ω–∞—Ç—å –±–µ—Å–µ–¥—É, –Ω–æ —Ä–∞–¥—ã, –∫–æ–≥–¥–∞ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç –¥—Ä—É–≥–æ–π.",
  "–ß–µ—Å—Ç–Ω–æ—Å—Ç—å –≤ –∞–Ω–æ–Ω–∏–º–Ω–æ–º —á–∞—Ç–µ –≤—ã—à–µ –Ω–∞ 70%.",
  "–û–¥–∏–Ω –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç —Å–ø–æ—Å–æ–±–µ–Ω –∏–∑–º–µ–Ω–∏—Ç—å –≤–µ—Å—å –¥–∏–∞–ª–æ–≥.",
  "–°–ª—É—á–∞–π–Ω—ã–π –¥–∏–∞–ª–æ–≥ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –Ω–∞ –≤–µ—Å—å –¥–µ–Ω—å."
  "–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ª—é–¥–µ–π –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è –Ω–µ–∑–Ω–∞–∫–æ–º—Ü–∞–º –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º –¥—Ä—É–∑—å—è–º.",
  "–û–¥–∏–Ω —Ç—ë–ø–ª—ã–π –æ—Ç–≤–µ—Ç –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∫ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫—É –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ.",
  "–ê–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç—å –¥–µ–ª–∞–µ—Ç –ª—é–¥–µ–π —á–µ—Å—Ç–Ω–µ–µ –ø–æ—á—Ç–∏ –≤ –¥–≤–∞ —Ä–∞–∑–∞.",
  "–ò–Ω–æ–≥–¥–∞ –æ–¥–∏–Ω –≤–æ–ø—Ä–æ—Å —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç —á–µ–ª–æ–≤–µ–∫–∞ –ª—É—á—à–µ –¥–æ–ª–≥–æ–π –±–µ—Å–µ–¥—ã.",
  "–ú–Ω–æ–≥–∏–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ —á–∞—Ç –ø—Ä–æ—Å—Ç–æ —É—Å–ª—ã—à–∞—Ç—å ¬´—Ç—ã –Ω–µ –æ–¥–∏–Ω¬ª.",
  "–í–µ–∂–ª–∏–≤–æ—Å—Ç—å –≤ —á–∞—Ç–µ –ø–æ–≤—ã—à–∞–µ—Ç —à–∞–Ω—Å –¥–ª–∏–Ω–Ω–æ–π –±–µ—Å–µ–¥—ã –≤ 4 —Ä–∞–∑–∞.",
  "–ù–µ–∑–Ω–∞–∫–æ–º—Ü—É –ª–µ–≥—á–µ —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å —Ç–æ, —á—Ç–æ –¥–∞–≤–Ω–æ —Ö—Ä–∞–Ω–∏—à—å –≤ —Å–µ–±–µ.",
  "–°–ø–æ–Ω—Ç–∞–Ω–Ω—ã–µ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã —á–∞—â–µ –≤—Å–µ–≥–æ –æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Å–∞–º—ã–º–∏ –∂–∏–≤—ã–º–∏.",
  "–ö–æ—Ä–æ—Ç–∫–∏–µ –æ—Ç–≤–µ—Ç—ã ‚Äî –Ω–µ –≤—Å–µ–≥–¥–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω—Ç–µ—Ä–µ—Å–∞.",
  "–ò–Ω–æ–≥–¥–∞ —á–µ–ª–æ–≤–µ–∫—É –Ω—É–∂–µ–Ω –Ω–µ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫, –∞ –≤–Ω–∏–º–∞–Ω–∏–µ.",
  "–ß–µ–º –ø—Ä–æ—â–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, —Ç–µ–º –ª–µ–≥—á–µ –Ω–∞—á–∞—Ç—å —Ä–∞–∑–≥–æ–≤–æ—Ä.",
  "–õ—é–¥–∏ –Ω–µ–¥–æ–æ—Ü–µ–Ω–∏–≤–∞—é—Ç, –Ω–∞—Å–∫–æ–ª—å–∫–æ –≤–∞–∂–Ω—ã –∏—Ö —Å–ª–æ–≤–∞ –¥–ª—è –¥—Ä—É–≥–∏—Ö.",
  "–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –±–æ–∏—Ç—Å—è –±—ã—Ç—å —Å–∫—É—á–Ω—ã–º–∏ ‚Äî –Ω–æ —Å–∫—É—á–Ω—ã—Ö –ø–æ—á—Ç–∏ –Ω–µ—Ç.",
  "–†–µ–∞–∫—Ü–∏—è ¬´üôÇ¬ª –∏–Ω–æ–≥–¥–∞ –∑–Ω–∞—á–∏—Ç –±–æ–ª—å—à–µ, —á–µ–º –¥–ª–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç.",
  "–¢—ë–ø–ª–æ–µ —Å–ª–æ–≤–æ –æ—Ç –Ω–µ–∑–Ω–∞–∫–æ–º—Ü–∞ –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è —É–¥–∏–≤–∏—Ç–µ–ª—å–Ω–æ –¥–æ–ª–≥–æ.",
  "–ß–∞—Å—Ç–æ –º—ã –∏—â–µ–º –ø–æ–Ω–∏–º–∞–Ω–∏—è, –∞ –Ω–µ –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞.",
  "–ü–µ—Ä–≤—ã–µ –¥–µ—Å—è—Ç—å —Å–µ–∫—É–Ω–¥ –±–µ—Å–µ–¥—ã —Å–∏–ª—å–Ω–æ –≤–ª–∏—è—é—Ç –Ω–∞ –µ—ë –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ.",
  "–õ—é–¥–∏ —á–∞—â–µ –º–æ–ª—á–∞—Ç –Ω–µ –æ—Ç —Å–∫—É–∫–∏, –∞ –æ—Ç –≤–æ–ª–Ω–µ–Ω–∏—è.",
  "–°–ø–æ–∫–æ–π–Ω—ã–π –¥–∏–∞–ª–æ–≥ —Å–Ω–∏–º–∞–µ—Ç —Å—Ç—Ä–µ—Å—Å –ª—É—á—à–µ –º—É–∑—ã–∫–∏.",
  "–ò–Ω–æ–≥–¥–∞ –Ω–µ–∑–Ω–∞–∫–æ–º–µ—Ü —É–º–µ–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å –ª—É—á—à–µ –≤—Å–µ—Ö.",
  "–¢–æ–Ω —Å–æ–æ–±—â–µ–Ω–∏—è —á–∏—Ç–∞–µ—Ç—Å—è –¥–∞–∂–µ —á–µ—Ä–µ–∑ —ç–∫—Ä–∞–Ω.",
  "–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ª—é–¥–µ–π –ø—Ä–∏—è—Ç–Ω–µ–µ, —á–µ–º –º—ã —Å–Ω–∞—á–∞–ª–∞ –¥—É–º–∞–µ–º.",
  "–ö–æ–≥–¥–∞ —á–µ–ª–æ–≤–µ–∫ –ø–∏—à–µ—Ç ¬´—è —Ç—É—Ç¬ª, –æ–Ω –≥–æ–≤–æ—Ä–∏—Ç –Ω–∞–º–Ω–æ–≥–æ –±–æ–ª—å—à–µ, —á–µ–º –∫–∞–∂–µ—Ç—Å—è.",
  "–ë—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã —Å–æ–∑–¥–∞—é—Ç –æ—â—É—â–µ–Ω–∏–µ –±–ª–∏–∑–æ—Å—Ç–∏.",
  "–ò–Ω–æ–≥–¥–∞ –ª—É—á—à–µ–µ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ ‚Äî —á–µ—Å—Ç–Ω—ã–π –≤–æ–ø—Ä–æ—Å.",
  "–ù–µ–ª–æ–≤–∫–∏–µ –ø–∞—É–∑—ã ‚Äî –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å —Ä–∞–∑–≥–æ–≤–æ—Ä–∞.",
  "–õ—é–¥–∏ —á–∞—â–µ –≤—Å–ø–æ–º–∏–Ω–∞—é—Ç —ç–º–æ—Ü–∏–∏ –æ—Ç –±–µ—Å–µ–¥—ã, —á–µ–º —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ.",
  "–ò—Å–∫—Ä–µ–Ω–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–∏–¥–Ω–æ —Å—Ä–∞–∑—É, –¥–∞–∂–µ –±–µ–∑ —Å–º–∞–π–ª–∏–∫–æ–≤.",
  "–û–¥–∏–Ω –æ—Ç–∫—Ä—ã—Ç—ã–π –≤–æ–ø—Ä–æ—Å –º–æ–∂–µ—Ç –æ–∂–∏–≤–∏—Ç—å –ª—é–±—É—é –ø–µ—Ä–µ–ø–∏—Å–∫—É.",
  "–ö–æ–≥–¥–∞ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫ –ø–∏—à–µ—Ç –ø–µ—Ä–≤—ã–º, —ç—Ç–æ —É–º–µ–Ω—å—à–∞–µ—Ç —Ç—Ä–µ–≤–æ–≥—É.",
  "–ê–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç—å –ø–æ–º–æ–≥–∞–µ—Ç –ª—é–¥—è–º –±—ã—Ç—å —Å–æ–±–æ–π.",
  "–ú—ã –Ω–µ–¥–æ–æ—Ü–µ–Ω–∏–≤–∞–µ–º —Å–∏–ª—É –ø—Ä–æ—Å—Ç–æ–≥–æ ¬´–∫–∞–∫ —Ç—ã?¬ª.",
  "–£–ª—ã–±–∫–∞ —á—É–≤—Å—Ç–≤—É–µ—Ç—Å—è –¥–∞–∂–µ –≤ —Ç–µ–∫—Å—Ç–µ.",
  "–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ—Ç –Ω–µ–∑–Ω–∞–∫–æ–º—Ü–∞ —á–∞—Å—Ç–æ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è –æ—Å–æ–±–µ–Ω–Ω–æ —Å–∏–ª—å–Ω–æ.",
  "–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ª—é–¥–µ–π —Ö–æ—Ç—è—Ç –±—ã—Ç—å —É—Å–ª—ã—à–∞–Ω–Ω—ã–º–∏, –∞ –Ω–µ –æ—Ü–µ–Ω—ë–Ω–Ω—ã–º–∏.",
  "–ò–Ω–æ–≥–¥–∞ –ª—É—á—à–µ–µ, —á—Ç–æ –º–æ–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å ‚Äî –∫–æ—Ä–æ—Ç–∫–æ–µ ¬´—è –ø–æ–Ω–∏–º–∞—é¬ª.",
  "–õ—ë–≥–∫–∏–π —é–º–æ—Ä –¥–µ–ª–∞–µ—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä –∫–æ–º—Ñ–æ—Ä—Ç–Ω–µ–µ –¥–ª—è –æ–±–æ–∏—Ö.",
  "–¢—ë–ø–ª—ã–π –¥–∏–∞–ª–æ–≥ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –Ω–∞ –≤–µ—Å—å –¥–µ–Ω—å.",
  "–í –∫–∞–∂–¥–æ–º —á–µ–ª–æ–≤–µ–∫–µ –µ—Å—Ç—å —á—Ç–æ-—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ ‚Äî –Ω—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ —Å–ø—Ä–æ—Å–∏—Ç—å.",
  "–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—ã–π —Ö–æ—á–µ—Ç –æ–±—â–∞—Ç—å—Å—è, –ø—Ä–æ—Å—Ç–æ –Ω–µ –≤—Å–µ —Ä–µ—à–∞—é—Ç—Å—è –Ω–∞—á–∞—Ç—å.",
];

window.onload = () => {
  const fb = document.getElementById("factBox");
  const ft = document.getElementById("factText");

  ft.textContent = facts[Math.floor(Math.random()*facts.length)];
  fb.style.display = "block";

  setTimeout(()=> fb.classList.add("show"), 20);

  document.getElementById("factClose").onclick = () => {
    fb.classList.remove("show");
    setTimeout(()=> fb.style.display="none",250);
  };

  updateRatingBox();
};

document.getElementById("themeBtn").onclick = () => {
  document.body.classList.toggle("light");
};

/* –û–ù–õ–ê–ô–ù */
socket.on("online_count", n => {
  document.getElementById("online").textContent = n;
});

/* –ü–û–ò–°–ö */
document.getElementById("findBtn").onclick = () => {
  hideRatingBox();

  document.getElementById("spinner").style.display="block";
  document.getElementById("stopSearch").style.display="block";
  document.getElementById("findBtn").style.display="none";

  const chatCount = +localStorage.getItem("chatCount") || 0;

  socket.emit("find", {
    gender: gender.value,
    searchfor: searchfor.value,
    chatCount
  });
};

/* –û–¢–ú–ï–ù–ê –ü–û–ò–°–ö–ê */
document.getElementById("stopSearch").onclick = () => {
  const inChat = document.getElementById("chat").style.display === "block";

  if(inChat){
    socket.emit("end");
  } else {
    socket.emit("cancel_search");
    showRatingBox();
  }

  document.getElementById("spinner").style.display="none";
  document.getElementById("stopSearch").style.display="none";
  document.getElementById("findBtn").style.display="block";
};

/* –°–¢–ê–†–¢ –ß–ê–¢–ê */
socket.on("chat_start", data => {
  hideRatingBox();

  document.getElementById("panel").style.display="none";
  document.getElementById("chat").style.display="block";

  messages.innerHTML="";
  typing.innerHTML="";

  const status = data?.partnerChatCount || 0;
  partnerStatus.textContent = "–°–æ–±–µ—Å–µ–¥–Ω–∏–∫: " + getStatus(status);

  spinner.style.display="none";
  stopSearch.style.display="none";
  findBtn.style.display="none";
  endBtn.style.display="block";
});

/* ==========================================
      –û–¢–ü–†–ê–í–ö–ê –¢–ï–ö–°–¢–ê
========================================== */

sendBtn.onclick = sendMsg;
msgInput.addEventListener("keydown", e=>{
  if(e.key === "Enter") sendMsg();
  socket.emit("typing");
});

function sendMsg(){
  const t = msgInput.value.trim();
  if(!t) return;

  appendMsg("–í—ã: " + t, "self");
  socket.emit("msg", t);
  msgInput.value="";
}

socket.on("msg", txt=>{
  appendMsg("–°–æ–±–µ—Å–µ–¥–Ω–∏–∫: " + txt, "other");
});

/* –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π */
function escapeHtml(s){
  return s.replace(/[&<>]/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;"}[c]));
}

function appendMsg(text, from="self"){
  const d = document.createElement("div");
  d.className="msg";
  d.dataset.from = from;
  d.innerHTML = escapeHtml(text) + '<span class="msg-react"></span>';

  if(from === "other")
    d.addEventListener("click", e=> openReactionMenu(e, d));

  messages.appendChild(d);
  messages.scrollTop = messages.scrollHeight;
}

/* ==========================================
      –¢YPING
========================================== */
socket.on("typing", ()=>{
  typing.innerHTML = '–ü–µ—á–∞—Ç–∞–µ—Ç <span class="typing-dots"><span class="dot"></span><span class="dot"></span><span class="dot"></span></span>';
  clearTimeout(window._tt);
  window._tt = setTimeout(()=> typing.innerHTML="",1300);
});

/* ==========================================
      –ì–û–õ–û–°–û–í–´–ï –°–û–û–ë–©–ï–ù–ò–Ø
========================================== */

let mediaRecorder = null;
let audioChunks = [];
const voiceBtn = document.getElementById("voiceBtn");

voiceBtn.onmousedown = startRecord;
voiceBtn.onmouseup   = stopRecord;
voiceBtn.onmouseleave = stopRecord;

async function startRecord(){
  voiceBtn.classList.add("recording");

  const stream = await navigator.mediaDevices.getUserMedia({audio:true});
  mediaRecorder = new MediaRecorder(stream);

  audioChunks = [];

  mediaRecorder.ondataavailable = e => audioChunks.push(e.data);

  mediaRecorder.onstop = () => {
    const blob = new Blob(audioChunks, {type:"audio/webm"});
    socket.emit("voice", blob);

    appendVoice(blob, "self");
  };

  mediaRecorder.start();
}

function stopRecord(){
  if(mediaRecorder && mediaRecorder.state !== "inactive"){
    voiceBtn.classList.remove("recording");
    mediaRecorder.stop();
  }
}

socket.on("voice", blob=>{
  appendVoice(blob, "other");
});

function appendVoice(blob, from="self"){
  const url = URL.createObjectURL(blob);

  const d = document.createElement("div");
  d.className = "msg";
  d.dataset.from = from;

  d.innerHTML = (from==="self"?"–í—ã:":"–°–æ–±–µ—Å–µ–¥–Ω–∏–∫:") +
    "<br><audio controls src='"+url+"'></audio>" +
    '<span class="msg-react"></span>';

  if(from==="other")
      d.addEventListener("click", e=> openReactionMenu(e, d));

  messages.appendChild(d);
  messages.scrollTop = messages.scrollHeight;
}

/* ==========================================
      –†–ï–ê–ö–¶–ò–ò
========================================== */

const reactionMenu = document.getElementById("reactionMenu");
let lastMsg = null;

function openReactionMenu(e, msg){
  lastMsg = msg;
  reactionMenu.style.display="flex";
  e.stopPropagation();
}

document.addEventListener("click", e=>{
  if(!reactionMenu.contains(e.target)){
    reactionMenu.style.display="none";
  }
});

document.querySelectorAll(".reaction").forEach(r=>{
  r.onclick = ()=>{
    const emoji = r.textContent;
    lastMsg.querySelector(".msg-react").textContent = emoji;

    const index = [...messages.children].indexOf(lastMsg);

    socket.emit("reaction", {emoji, index});

    reactionMenu.style.display="none";
  };
});

socket.on("reaction", data=>{
  const msg = messages.children[data.index];
  if(msg) msg.querySelector(".msg-react").textContent = data.emoji;
});

/* ==========================================
      –ó–ê–í–ï–†–®–ï–ù–ò–ï –ß–ê–¢–ê
========================================== */

endBtn.onclick = ()=> socket.emit("end");

socket.on("chat_end", ()=>{
  chat.style.display="none";
  panel.style.display="block";

  messages.innerHTML="";
  partnerStatus.textContent="";
  reactionMenu.style.display="none";

  spinner.style.display="none";
  stopSearch.style.display="none";
  findBtn.style.display="block";
  endBtn.style.display="none";

  let c = +localStorage.getItem("chatCount") || 0;
  c++;
  localStorage.setItem("chatCount", c);

  updateRatingBox();
  showRatingBox();
});

/* ==========================================
      –†–ï–ô–¢–ò–ù–ì
========================================== */

function getStatus(n){
  if(n>=1200) return "–ö–û–†–û–õ–¨";
  if(n>=700) return "–ü–æ–ø—É–ª—è—Ä–Ω—ã–π —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫";
  if(n>=300) return "–û–ø—ã—Ç–Ω—ã–π —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫";
  if(n>=50) return "–•–æ—Ä–æ—à–∏–π —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫";
  return "–ù–æ–≤–∏—á–æ–∫";
}

function updateRatingBox(){
  const n = +localStorage.getItem("chatCount") || 0;
  ratingYou.textContent = `–í–∞—à —É—Ä–æ–≤–µ–Ω—å: ${getStatus(n)} ‚Äî (${n} —á–∞—Ç–æ–≤)`;
}

function hideRatingBox(){ ratingBox.style.display="none"; }
function showRatingBox(){ ratingBox.style.display="block"; }
</script>

</body>
</html>
