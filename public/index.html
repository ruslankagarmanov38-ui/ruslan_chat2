<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>Ruslan Chat ‚Äî –∞–Ω–æ–Ω–∏–º–Ω—ã–π —á–∞—Ç</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="icon" type="image/x-icon" href="favicon.ico">
<style>
/* –¢–ï–ú–´ */
:root{--bg:#000;--text:#0f0;--panel-bg:rgba(0,255,50,0.06);--msg-bg:#1d1f23;--input-bg:#222;--logo-bg:#00ff91}
.light{--bg:#f2f2f2;--text:#000;--panel-bg:#fff;--msg-bg:#e6e6e6;--input-bg:#fff;--logo-bg:#00c86d}
body{margin:0;font-family:Arial, sans-serif;background:var(--bg);color:var(--text);transition:.3s}
/* –ù–ï–û–ù */
.glow{text-shadow:0 0 10px #00ff91,0 0 20px #00ff91,0 0 40px #00ff91}

/* –®–ê–ü–ö–ê */
#header{display:flex;justify-content:space-between;align-items:center;padding:15px 25px;font-size:26px;font-weight:bold}
#logo{background:var(--logo-bg);color:#000;padding:7px 14px;border-radius:12px;font-weight:bold;box-shadow:0 0 20px var(--logo-bg)}
#themeBtn{padding:10px 15px;background:var(--logo-bg);border:none;border-radius:10px;cursor:pointer;box-shadow:0 0 18px var(--logo-bg)}

/* –ì–õ–ê–í–ù–ê–Ø –ü–ê–ù–ï–õ–¨ */
#panel{width:70%;margin:20px auto;padding:25px;border-radius:20px;background:var(--panel-bg);box-shadow:0 0 25px #00ff91}
label{margin-bottom:5px;font-size:18px;display:block}
select{width:180px;padding:10px;border-radius:8px;border:none}

/* –ö–ù–û–ü–ö–ò */
#findBtn,#shareBtn{width:100%;padding:18px;margin-top:20px;font-size:18px;font-weight:bold;background:#00ff66;border-radius:12px;border:none;cursor:pointer;box-shadow:0 0 20px #00ff91}
#findBtn:hover,#shareBtn:hover{transform:scale(1.03)}
#stopSearch{display:none;width:100%;padding:14px;background:#ff3b3b;border-radius:10px;border:none;color:white;margin-top:15px}

/* –°–ü–ò–ù–ù–ï–† */
#spinner{display:none;margin:15px auto;width:50px;height:50px;border:6px solid #333;border-top:6px solid #00ff91;border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{100%{transform:rotate(360deg)}}

/* –ß–ê–¢ */
#chat{display:none;width:70%;margin:20px auto}
#messages{background:#0d0f12;height:430px;overflow-y:auto;padding:20px;border-radius:16px;box-shadow:0 0 25px #00ff91}
.msg{background:var(--msg-bg);color:var(--text);padding:12px 16px;border-radius:14px;margin-bottom:10px;max-width:70%;animation:fade .25s ease;position:relative}
@keyframes fade{from{opacity:0;transform:translateY(10px)}to{opacity:1}}
#typing{height:22px;font-size:15px;color:#00ff91;display:flex;align-items:center;gap:8px;font-weight:600}

/* typing dots (B2 - –º—è–≥–∫–∏–π –ø—Ä—ã–∂–æ–∫ –±–æ–ª—å—à–∏—Ö —Ç–æ—á–µ–∫) */
.typing-dots{display:inline-flex;gap:8px;align-items:center}
.typing-dots .dot{width:10px;height:10px;background:#00ff91;border-radius:50%;display:inline-block;transform:translateY(0);opacity:0.85;animation:dot-jump 1s infinite}
.typing-dots .dot:nth-child(1){animation-delay:0s}
.typing-dots .dot:nth-child(2){animation-delay:0.12s}
.typing-dots .dot:nth-child(3){animation-delay:0.24s}
@keyframes dot-jump{
  0%{transform:translateY(0);opacity:.35}
  35%{transform:translateY(-6px);opacity:1}
  70%{transform:translateY(0);opacity:.6}
  100%{transform:translateY(0);opacity:.35}
}

/* send panel */
#sendPanel{display:flex;margin-top:10px;gap:10px}
#msgInput{flex:1;padding:12px;border-radius:12px;border:none;background:var(--input-bg);color:var(--text)}
#sendBtn{padding:12px 25px;background:#00ff91;border-radius:10px;border:none;cursor:pointer}
#endBtn{margin-top:15px;width:100%;padding:14px;background:#ff3b3b;color:white;border:none;border-radius:10px;display:none}

/* —Ä–µ–∞–∫—Ü–∏–∏ */
.reaction-menu{position:absolute;background:rgba(0,255,80,0.15);border:1px solid #00ff91;padding:6px 8px;border-radius:10px;display:none;gap:6px;box-shadow:0 0 12px #00ff91;z-index:9999;user-select:none}
.reaction{cursor:pointer;font-size:20px;padding:6px;border-radius:6px}
.reaction:hover{transform:scale(1.15)}
.msg-react{font-size:18px;margin-left:8px;opacity:.95;position:absolute;right:10px;top:10px}

/* —Ä–µ–π—Ç–∏–Ω–≥ */
#ratingBox{width:70%;margin:12px auto 30px;padding:10px 14px;border-radius:12px;background:rgba(0,255,145,0.03);border:1px solid rgba(0,255,145,0.12);color:#bfffe6;text-align:center;box-shadow:0 0 12px rgba(0,255,145,0.06);font-size:14px;line-height:1.4}
#ratingBox .title{color:#00ff91;font-weight:700;margin-bottom:6px;text-shadow:0 0 8px #00ff91}
#ratingBox .levels{display:flex;justify-content:center;gap:12px;margin-top:8px;flex-wrap:wrap}
#ratingBox .level{padding:6px 10px;border-radius:8px;background:rgba(0,0,0,0.16);border:1px solid rgba(0,255,145,0.06);font-weight:600;color:#e6fff5;font-size:13px}
#ratingBox .you{margin-top:8px;color:#00ff91;font-weight:700}

/* —Ñ–∞–∫—Ç –¥–Ω—è tweaks (pop-in) */
#factBox{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(.8);width:300px;padding:18px;background:rgba(0,0,0,0.92);border-radius:14px;border:2px solid #00ff91;box-shadow:0 0 20px #00ff91;opacity:0;transition:.25s ease;z-index:9999;color:#fff;display:none}
#factBox.show{opacity:1;transform:translate(-50%,-50%) scale(1)}
#factClose{position:absolute;right:12px;top:6px;cursor:pointer;font-size:18px;color:#00ff91}
#factText{text-align:center;font-size:15px;min-height:40px}
</style>

<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
</head>
<body>

<!-- –§–∞–∫—Ç –¥–Ω—è -->
<div id="factBox">
  <div id="factClose">‚úñ</div>
  <h3 style="text-align:center;margin-top:5px;color:#00ff91;" class="glow">–§–∞–∫—Ç –¥–Ω—è</h3>
  <p id="factText"></p>
</div>

<div id="header">
  <div style="display:flex;align-items:center;gap:12px">
    <div id="logo">RC</div>
    <span class="glow">Ruslan Chat</span>
  </div>
  <button id="themeBtn">–¢—ë–º–Ω–∞—è —Ç–µ–º–∞</button>
</div>

<div style="text-align:center;margin-top:5px;font-size:18px;color:var(--text)" class="glow">
  9 –∏–∑ 10 –Ω–∞—Ö–æ–¥—è—Ç –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–≥–æ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞ –∑–∞ 5 —Å–µ–∫—É–Ω–¥
</div>

<div id="panel">
  <div style="font-size:18px">–û–Ω–ª–∞–π–Ω: <span id="online">0</span></div><br>
  <label>–í–∞—à –ø–æ–ª:</label>
  <select id="gender"><option>–ú—É–∂—á–∏–Ω–∞</option><option>–ñ–µ–Ω—â–∏–Ω–∞</option></select>
  <label style="margin-top:15px">–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–π –ø–æ–ª:</label>
  <select id="searchfor"><option>–ò—â—É –ª—é–±–æ–π</option><option>–ò—â—É –º—É–∂—á–∏–Ω—É</option><option>–ò—â—É –∂–µ–Ω—â–∏–Ω—É</option></select>

  <button id="findBtn">–ù–ê–ô–¢–ò –°–û–ë–ï–°–ï–î–ù–ò–ö–ê</button>
  <div id="spinner"></div>
  <button id="stopSearch">–ü–†–ï–ö–†–ê–¢–ò–¢–¨ –ü–û–ò–°–ö</button>

  <button id="shareBtn">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å–∞–π—Ç–æ–º</button>
</div>

<!-- –ß–ê–¢ -->
<div id="chat">
  <div id="partnerStatus" style="text-align:center;color:#00ff91;margin-bottom:8px"></div>
  <div id="messages"></div>
  <div id="typing"></div>

  <div id="sendPanel">
    <input id="msgInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." autocomplete="off" />
    <button id="sendBtn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
  </div>

  <button id="endBtn">–ó–∞–≤–µ—Ä—à–∏—Ç—å —á–∞—Ç</button>
</div>

<!-- –º–µ–Ω—é —Ä–µ–∞–∫—Ü–∏–π -->
<div id="reactionMenu" class="reaction-menu">
  <div class="reaction">‚ù§Ô∏è</div>
  <div class="reaction">üòÇ</div>
  <div class="reaction">üëç</div>
  <div class="reaction">üí©</div>
  <div class="reaction">‚ùó</div>
  <div class="reaction">üò°</div>
  <div class="reaction">üò≠</div>
  <div class="reaction">üò±</div>
</div>

<!-- —Ä–µ–π—Ç–∏–Ω–≥ -->
<div id="ratingBox">
  <div class="title">‚≠ê –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞?</div>
  <div class="desc">–ö–∞–∂–¥—ã–π –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–π —á–∞—Ç –ø–æ–≤—ã—à–∞–µ—Ç –≤–∞—à —É—Ä–æ–≤–µ–Ω—å. –í–∞—à —Å—Ç–∞—Ç—É—Å –≤–∏–¥—è—Ç –¥—Ä—É–≥–∏–µ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏.</div>
  <div class="levels">
    <div class="level">üü¢ –ù–æ–≤–∏—á–æ–∫ ‚Äî 0‚Äì49</div>
    <div class="level">üîµ –•–æ—Ä–æ—à–∏–π ‚Äî 50‚Äì299</div>
    <div class="level">üü£ –û–ø—ã—Ç–Ω—ã–π ‚Äî 300‚Äì699</div>
    <div class="level">üëë –ü–æ–ø—É–ª—è—Ä–Ω—ã–π ‚Äî 700‚Äì1199</div>
    <div class="level">üëëüëë –ö–û–†–û–õ–¨ ‚Äî 1200+</div>
  </div>
  <div id="ratingYou" class="you">–í–∞—à —É—Ä–æ–≤–µ–Ω—å: ‚Äî</div>
</div>

<script>
/* ============= CLIENT ============= */
const socket = io();
let typingTimer = null;
let selectedMsg = null;

/* 50 —Ñ–∞–∫—Ç–æ–≤ */
const facts = [
"–í —Å—Ä–µ–¥–Ω–µ–º —á–µ–ª–æ–≤–µ–∫ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –Ω–µ–∑–Ω–∞–∫–æ–º—Ü—É –≤ 2 —Ä–∞–∑–∞ –±—ã—Å—Ç—Ä–µ–µ.",
"–ö–∞–∂–¥—ã–π —Ç—Ä–µ—Ç–∏–π –Ω–∞—á–∏–Ω–∞–µ—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä —Å —á–µ–ª–æ–≤–µ–∫–æ–º, –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–∏–∫–æ–≥–¥–∞ –±—ã –Ω–µ –≤—ã–±—Ä–∞–ª –≤ —Ä–µ–∞–ª—å–Ω–æ–π –∂–∏–∑–Ω–∏.",
"–°–∞–º–æ–µ –∫–æ—Ä–æ—Ç–∫–æ–µ –æ–±—â–µ–Ω–∏–µ –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å —Å–∞–º—ã–º –∑–∞–ø–æ–º–∏–Ω–∞—é—â–∏–º—Å—è.",
"–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ª—é–¥–µ–π –±–æ—è—Ç—Å—è –Ω–∞—á–∏–Ω–∞—Ç—å –±–µ—Å–µ–¥—É, –Ω–æ —Ä–∞–¥—ã, –∫–æ–≥–¥–∞ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç –¥—Ä—É–≥–æ–π.",
"–ß–µ—Å—Ç–Ω–æ—Å—Ç—å –≤ –∞–Ω–æ–Ω–∏–º–Ω–æ–º —á–∞—Ç–µ –≤—ã—à–µ –Ω–∞ 70%.",
"–õ—é–¥–∏ —á–∞—â–µ –æ–±—Å—É–∂–¥–∞—é—Ç –º–µ—á—Ç—ã —Å –Ω–µ–∑–Ω–∞–∫–æ–º—Ü–∞–º–∏, —á–µ–º —Å –¥—Ä—É–∑—å—è–º–∏.",
"–£–ª—ã–±–∫–∞ –≤ —Ç–µ–∫—Å—Ç–µ —á—É–≤—Å—Ç–≤—É–µ—Ç—Å—è, –¥–∞–∂–µ –µ—Å–ª–∏ –µ—ë –Ω–µ –≤–∏–¥–Ω–æ.",
"–°–∞–º—ã–π —á–∞—Å—Ç—ã–π –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å ‚Äî ¬´–ö–∞–∫ –¥–µ–ª–∞?¬ª ‚Äî –Ω–æ –æ–Ω –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç.",
"–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤ –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è –ø–æ–∑–∂–µ, —á–µ–º —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∏ –æ–∂–∏–¥–∞–ª–∏.",
"–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–∑–Ω–∞–∫–æ–º—Ü—ã –ø–æ–Ω–∏–º–∞—é—Ç –Ω–∞—Å –ª—É—á—à–µ –∑–Ω–∞–∫–æ–º—ã—Ö.",
"–û–ø—ã—Ç –æ–±—â–µ–Ω–∏—è —Ä–∞—Å—Ç—ë—Ç –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º –∫–∞–∂–µ—Ç—Å—è.",
"–°–ª—É—á–∞–π–Ω—ã–π –¥–∏–∞–ª–æ–≥ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –Ω–∞ –≤–µ—Å—å –¥–µ–Ω—å.",
"–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ª—é–¥–µ–π –±–æ—è—Ç—Å—è –±—ã—Ç—å —Å–∫—É—á–Ω—ã–º–∏ ‚Äî –Ω–æ –∏–º–∏ –ø–æ—á—Ç–∏ –Ω–∏–∫—Ç–æ –Ω–µ –±—ã–≤–∞–µ—Ç.",
"–õ—é–¥–∏ —á–∏—Ç–∞—é—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–µ–µ, —á–µ–º –∫–∞–∂–µ—Ç—Å—è.",
"–ö–∞–∂–¥—ã–π —Ä–∞–∑–≥–æ–≤–æ—Ä ‚Äî —ç—Ç–æ –º–∞–ª–µ–Ω—å–∫–∞—è –∏—Å—Ç–æ—Ä–∏—è.",
"–ú—ã –Ω–µ–¥–æ–æ—Ü–µ–Ω–∏–≤–∞–µ–º, –Ω–∞—Å–∫–æ–ª—å–∫–æ –º–æ–∂–µ–º –±—ã—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–º–∏.",
"–ù–µ–∑–Ω–∞–∫–æ–º—Ü—ã —á–∞—Å—Ç–æ —á–µ—Å—Ç–Ω–µ–µ –¥—Ä—É–∑–µ–π.",
"–ò–Ω–æ–≥–¥–∞ –æ–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –º–æ–∂–µ—Ç —Å–ø–∞—Å—Ç–∏ –¥–µ–Ω—å.",
"–ß–∞—â–µ –≤—Å–µ–≥–æ –ª—é–¥–∏ –ø—Ä–∏—Ö–æ–¥—è—Ç ¬´–Ω–∞ –º–∏–Ω—É—Ç—É¬ª, –Ω–æ –æ—Å—Ç–∞—é—Ç—Å—è –Ω–∞–¥–æ–ª–≥–æ.",
"–û–¥–∏–Ω –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç —Å–ø–æ—Å–æ–±–µ–Ω –∏–∑–º–µ–Ω–∏—Ç—å –≤—Å—é –±–µ—Å–µ–¥—É.",
"–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ª—é–¥–µ–π –∏—â—É—Ç –Ω–µ —Ä–∞–∑–≥–æ–≤–æ—Ä, –∞ –ø–æ–Ω–∏–º–∞–Ω–∏–µ.",
"–¢—ë–ø–ª–∞—è –±–µ—Å–µ–¥–∞ –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è –¥–æ–ª—å—à–µ —Ö–æ–ª–æ–¥–Ω–æ–π.",
"–ö–∞–∂–¥—ã–π —á–µ—Ç–≤—ë—Ä—Ç—ã–π —á–µ–ª–æ–≤–µ–∫ –≤ —á–∞—Ç–µ ‚Äî –∏–Ω—Ç—Ä–æ–≤–µ—Ä—Ç.",
"–ò–Ω–æ–≥–¥–∞ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫ –∏—â–µ—Ç –Ω–µ –æ—Ç–≤–µ—Ç, –∞ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ.",
"–õ—É—á—à–∏–µ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã —Ä–æ–∂–¥–∞—é—Ç—Å—è —Å–ª—É—á–∞–π–Ω–æ.",
"–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ª—é–¥–µ–π —Ä–∞–¥—ã, –∫–æ–≥–¥–∞ –∏—Ö —Å–ª—É—à–∞—é—Ç.",
"–ö–æ—Ä–æ—Ç–∫–∏–π –¥–∏–∞–ª–æ–≥ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ü–µ–Ω–Ω–µ–µ –¥–ª–∏–Ω–Ω–æ–≥–æ.",
"–ö–∞–∂–¥—ã–π —Ä–∞–∑, –Ω–∞—á–∏–Ω–∞—è —á–∞—Ç, –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è –∏—Å—Ç–æ—Ä–∏—è.",
"–¢–∏—à–∏–Ω–∞ –≤ –¥–∏–∞–ª–æ–≥–µ ‚Äî –Ω–µ –∫–æ–Ω–µ—Ü, –∞ —á–∞—Å—Ç—å —Ä–∏—Ç–º–∞.",
"–ò—Å–∫—Ä–µ–Ω–Ω–æ—Å—Ç—å —Ü–µ–Ω–∏—Ç—Å—è –≤—ã—à–µ –≤—Å–µ–≥–æ.",
"–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ª—é–¥–µ–π —Å–∫—Ä—ã–≤–∞—é—Ç, —á—Ç–æ –∏–º –æ–¥–∏–Ω–æ–∫–æ.",
"–°–ª–æ–≤–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ ‚Äî —Å–∞–º—ã–µ —Å–∏–ª—å–Ω—ã–µ —Å–ª–æ–≤–∞.",
"–õ—é–¥–∏ –∑–∞–±—ã–≤–∞—é—Ç —Ç–µ–∫—Å—Ç, –Ω–æ –Ω–µ –∑–∞–±—ã–≤–∞—é—Ç —ç–º–æ—Ü–∏–∏.",
"–û—Ç–∫—Ä—ã—Ç—ã–π –≤–æ–ø—Ä–æ—Å –≤—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ª—É—á—à–µ –∑–∞–∫—Ä—ã—Ç–æ–≥–æ.",
"–ù–µ–∑–Ω–∞–∫–æ–º—Ü—ã –º–æ–≥—É—Ç —Å–∫–∞–∑–∞—Ç—å —Ç–æ, —á–µ–≥–æ –Ω–µ —Å–∫–∞–∂—É—Ç –∑–Ω–∞–∫–æ–º—ã–µ.",
"–°–∞–º—ã–π —Ü–µ–Ω–Ω—ã–π —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫ ‚Äî —Ç–æ—Ç, –∫—Ç–æ —Å–ª—É—à–∞–µ—Ç.",
"–ú—ã —á–∞—Å—Ç–æ –Ω–µ –∑–Ω–∞–µ–º, –Ω–∞—Å–∫–æ–ª—å–∫–æ –≤–∞–∂–Ω—ã –Ω–∞—à–∏ —Å–ª–æ–≤–∞.",
"–õ—É—á—à–∏–µ –æ—Ç–≤–µ—Ç—ã –ø—Ä–∏—Ö–æ–¥—è—Ç —Å–ø–æ–Ω—Ç–∞–Ω–Ω–æ.",
"–ú–Ω–æ–≥–∏–µ –ª—é–¥–∏ –±–æ—è—Ç—Å—è –Ω–∞—á–∞—Ç—å, –Ω–æ –Ω–µ –±–æ—è—Ç—Å—è –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å.",
"–°–ª—É—á–∞–π–Ω–æ—Å—Ç—å ‚Äî —ç—Ç–æ –Ω–µ –æ—à–∏–±–∫–∞, –∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å.",
"–ö–∞–∂–¥—ã–π –¥–∏–∞–ª–æ–≥ —É–Ω–∏–∫–∞–ª–µ–Ω ‚Äî –¥–∞–∂–µ –µ—Å–ª–∏ —Ç–µ–º—ã –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ.",
"–õ—é–¥–∏ —á–∞—â–µ –ø–∏—à—É—Ç –ø—Ä–∞–≤–¥—É –≤ –∞–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç–∏.",
"–û–¥–∏–Ω –≤–æ–ø—Ä–æ—Å –º–æ–∂–µ—Ç —Ä–∞—Å–∫—Ä—ã—Ç—å —á–µ–ª–æ–≤–µ–∫–∞.",
"–ò–Ω–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –≤—Å–µ–≥–æ –æ–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ, —á—Ç–æ–±—ã —Ä–∞–∑–≥–æ–≤–æ—Ä –æ–∂–∏–ª.",
"–ß–µ–º –º–µ–Ω—å—à–µ –æ–∂–∏–¥–∞–Ω–∏–π ‚Äî —Ç–µ–º –ª—É—á—à–µ –¥–∏–∞–ª–æ–≥.",
"–ú–Ω–æ–≥–∏–µ –ø—Ä–∏—Ö–æ–¥—è—Ç —Å—é–¥–∞, —á—Ç–æ–±—ã –ø—Ä–æ—Å—Ç–æ –Ω–µ –±—ã—Ç—å –æ–¥–Ω–∏.",
"–¢—ë–ø–ª–æ–µ —Å–ª–æ–≤–æ ‚Äî —ç—Ç–æ –ª—É—á—à–∏–π –ø–æ–¥–∞—Ä–æ–∫ –Ω–µ–∑–Ω–∞–∫–æ–º—Ü—É."
];

/* --- —Ñ–∞–∫—Ç –¥–Ω—è –ø–æ–∫–∞–∑–∞: –ø—Ä–æ—Å—Ç–æ–π —Ç–µ–∫—Å—Ç, –µ–¥–∏–Ω–æ–∂–¥—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ --- */
window.addEventListener('load', () => {
  const box = document.getElementById('factBox');
  const text = document.getElementById('factText');
  text.textContent = facts[Math.floor(Math.random() * facts.length)];
  box.style.display = 'block';
  setTimeout(()=> box.classList.add('show'), 20);
  document.getElementById('factClose').onclick = () => {
    box.classList.remove('show');
    setTimeout(()=> box.style.display='none', 220);
  };

  updateRatingBox();
  showRatingBox();
});

/* –¢–ï–ú–ê */
document.getElementById('themeBtn').onclick = () =>{
  document.body.classList.toggle('light');
  document.getElementById('themeBtn').textContent = document.body.classList.contains('light') ? '–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞' : '–¢—ë–º–Ω–∞—è —Ç–µ–º–∞';
};

/* –®–ê–†–ò–ù–ì */
document.getElementById('shareBtn').onclick = () =>{
  const url = location.href;
  if(navigator.share) navigator.share({title:'Ruslan Chat', url});
  else { navigator.clipboard.writeText(url); alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!'); }
};

/* –û–ù–õ–ê–ô–ù */
socket.on('online_count', n => document.getElementById('online').textContent = n);

/* –ü–û–ò–°–ö */
document.getElementById('findBtn').onclick = () =>{
  hideRatingBox();
  document.getElementById('spinner').style.display='block';
  document.getElementById('stopSearch').style.display='block';
  document.getElementById('findBtn').style.display='none';

  const chatCount = +localStorage.getItem('chatCount') || 0;
  socket.emit('find', { gender: document.getElementById('gender').value, searchfor: document.getElementById('searchfor').value, chatCount});
};

/* –ö–Ω–æ–ø–∫–∞ "–ø—Ä–µ–∫—Ä–∞—Ç–∏—Ç—å –ø–æ–∏—Å–∫" ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–π—Ç–∏–Ω–≥ */
document.getElementById('stopSearch').onclick = () =>{
  document.getElementById('spinner').style.display='none';
  document.getElementById('stopSearch').style.display='none';
  document.getElementById('findBtn').style.display='block';

  socket.emit('cancel_search');

  // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–π—Ç–∏–Ω–≥ –≤ –º–µ–Ω—é
  showRatingBox();
};

/* –°–¢–ê–†–¢ –ß–ê–¢–ê */
socket.on('chat_start', data => {
  hideRatingBox();
  document.getElementById('panel').style.display='none';
  document.getElementById('chat').style.display='block';
  document.getElementById('messages').innerHTML='';
  document.getElementById('typing').innerHTML='';

  const partnerCount = data?.partnerChatCount || 0;
  document.getElementById('partnerStatus').textContent = '–°–æ–±–µ—Å–µ–¥–Ω–∏–∫: ' + (getStatus(partnerCount) || '–ù–æ–≤—ã–π —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫');

  document.getElementById('spinner').style.display='none';
  document.getElementById('stopSearch').style.display='none';
  document.getElementById('findBtn').style.display='none';
  document.getElementById('endBtn').style.display='block';
});

/* –û–¢–ü–†–ê–í–ö–ê –°–û–û–ë–©–ï–ù–ò–ô */
document.getElementById('sendBtn').onclick = sendMsg;
document.getElementById('msgInput').addEventListener('keydown', e=>{
  if(e.key === 'Enter') sendMsg();
  socket.emit('typing');
});

function sendMsg(){
  const input = document.getElementById('msgInput');
  const t = input.value.trim();
  if(!t) return;
  appendMsg('–í—ã: ' + t, 'self');
  socket.emit('msg', t);
  input.value = '';
}

/* –ü–û–õ–£–ß–ï–ù–ò–ï */
socket.on('msg', t => appendMsg('–°–æ–±–µ—Å–µ–¥–Ω–∏–∫: ' + t, 'other'));

/* append ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç innerHTML, –Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç */
function escapeHtml(s){
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}
function appendMsg(text, from='self'){
  const wrap = document.getElementById('messages');
  const d = document.createElement('div');
  d.className = 'msg';
  d.dataset.from = from;

  // —ç–∫—Ä–∞–Ω–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ç–µ–∫—Å—Ç, –∑–∞—Ç–µ–º –¥–æ–±–∞–≤–ª—è–µ–º —Å–ø–∞–Ω –¥–ª—è —Ä–µ–∞–∫—Ü–∏–∏
  d.innerHTML = escapeHtml(text) + ' <span class="msg-react"></span>';

  if(from === 'other'){
    d.addEventListener('click', e => openReactionMenu(e, d));
  }
  wrap.appendChild(d);
  wrap.scrollTop = wrap.scrollHeight;
}

/* –ü–ï–ß–ê–¢–ê–ï–¢ (B2 - –º—è–≥–∫–∏–π –ø—Ä—ã–∂–æ–∫ —Ç–æ—á–µ–∫) */
socket.on('typing', () => {
  const typing = document.getElementById('typing');
  typing.innerHTML = '–ü–µ—á–∞—Ç–∞–µ—Ç <span class="typing-dots"><span class="dot"></span><span class="dot"></span><span class="dot"></span></span>';
  clearTimeout(typingTimer);
  typingTimer = setTimeout(()=> { typing.innerHTML = ''; }, 1400);
});

/* –†–ï–ê–ö–¶–ò–ò */
const reactionMenu = document.getElementById('reactionMenu');

function openReactionMenu(e, msg){
  if(!msg || msg.dataset.from === 'self') return;
  selectedMsg = msg;
  const menu = reactionMenu;
  menu.style.display = 'flex';

  // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ: –ø–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–µ–º, —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –≥—Ä–∞–Ω–∏—Ü
  const rect = msg.getBoundingClientRect();
  let left = rect.left + 8;
  let top = rect.bottom + window.scrollY + 6;

  // –µ—Å–ª–∏ —Å–ø—Ä–∞–≤–∞ –Ω–µ –≤–ª–µ–∑–∞–µ—Ç ‚Äî —Å–¥–≤–∏–Ω—É—Ç—å
  const menuWidthGuess = 260; // –ø—Ä–∏–º–µ—Ä, –±–µ–∑–æ–ø–∞—Å–Ω–æ
  if(left + menuWidthGuess > window.innerWidth) left = window.innerWidth - menuWidthGuess - 12;
  if(left < 8) left = 8;

  menu.style.left = left + 'px';
  menu.style.top = top + 'px';

  e.stopPropagation();
}

/* –≤—ã–±–æ—Ä —Ä–µ–∞–∫—Ü–∏–∏ (–¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º —ç–ª–µ–º–µ–Ω—Ç–∞–º) */
document.querySelectorAll('.reaction').forEach(node => {
  node.addEventListener('click', ev => {
    ev.stopPropagation();
    if(!selectedMsg) return;
    const emoji = node.textContent;
    selectedMsg.querySelector('.msg-react').textContent = emoji;

    const list = Array.from(document.getElementById('messages').children);
    const index = list.indexOf(selectedMsg);
    socket.emit('reaction', { emoji, index });

    reactionMenu.style.display = 'none';
  });
});

/* –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∞–∫—Ü–∏—é –æ—Ç –ø–∞—Ä—Ç–Ω—ë—Ä–∞ */
socket.on('reaction', data => {
  if(!data) return;
  const list = document.getElementById('messages').children;
  const msg = list[data.index];
  if(msg) msg.querySelector('.msg-react').textContent = data.emoji;
});

/* —Å–∫—Ä—ã—Ç—å –º–µ–Ω—é –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ */
document.addEventListener('click', e=>{
  const menu = document.getElementById('reactionMenu');
  if(!menu.contains(e.target)) menu.style.display = 'none';
});

/* –ó–ê–í–ï–†–®–ï–ù–ò–ï –ß–ê–¢–ê */
document.getElementById('endBtn').onclick = () => socket.emit('end');

socket.on('chat_end', () => {
  document.getElementById('chat').style.display='none';
  document.getElementById('panel').style.display='block';
  document.getElementById('messages').innerHTML='';
  document.getElementById('partnerStatus').textContent='';

  document.getElementById('spinner').style.display='none';
  document.getElementById('stopSearch').style.display='none';
  document.getElementById('findBtn').style.display='block';
  document.getElementById('endBtn').style.display='none';

  showRatingBox();

  let c = +localStorage.getItem('chatCount') || 0;
  c++;
  localStorage.setItem('chatCount', c);
  updateRatingBox();
});

/* –†–ï–ô–¢–ò–ù–ì */
function getStatus(n){
  if(n>=1200) return '–ö–û–†–û–õ–¨';
  if(n>=700) return '–ü–æ–ø—É–ª—è—Ä–Ω—ã–π —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫';
  if(n>=300) return '–û–ø—ã—Ç–Ω—ã–π —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫';
  if(n>=50) return '–•–æ—Ä–æ—à–∏–π —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫';
  return '–ù–æ–≤–∏—á–æ–∫';
}
function updateRatingBox(){
  const n = +localStorage.getItem('chatCount') || 0;
  document.getElementById('ratingYou').textContent = `–í–∞—à —É—Ä–æ–≤–µ–Ω—å: ${getStatus(n)} ‚Äî (${n} —á–∞—Ç–æ–≤)`;
}
function hideRatingBox(){ document.getElementById('ratingBox').style.display='none' }
function showRatingBox(){ document.getElementById('ratingBox').style.display='block' }
document.getElementById('findBtn').addEventListener('click', hideRatingBox);

/* –æ—á–∏—Å—Ç–∫–∞ selectedMsg –ø—Ä–∏ —É—Ö–æ–¥–µ */
window.addEventListener('beforeunload', ()=> selectedMsg = null);
</script>
</body>
</html>
