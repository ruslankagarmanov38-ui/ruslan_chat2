<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Ruslan Chat</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
    body {
        margin: 0;
        background: #070707;
        color: white;
        font-family: Arial, sans-serif;
        transition: 0.3s;
    }
    body.light {
        background: #f5f5f5;
        color: black;
    }

    .top {
        display: flex;
        align-items: center;
        padding: 15px;
        background: rgba(0,0,0,0.4);
        backdrop-filter: blur(8px);
        border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    body.light .top {
        background: rgba(255,255,255,0.7);
    }

    .logo {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .logo-icon {
        width: 42px;
        height: 42px;
        background: #0aff64;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: #003300;
        font-size: 18px;
        box-shadow: 0 0 15px #00ff80;
    }

    .logo-text {
        font-size: 24px;
        font-weight: bold;
        color: #00ff88;
        text-shadow: 0 0 8px #00ff80;
    }

    .themeBtn {
        margin-left: auto;
        background: #0aff64;
        border: none;
        padding: 7px 15px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        color: #003300;
        box-shadow: 0 0 12px #00ff80;
        transition: 0.3s;
    }

    .panel {
        margin: 20px auto;
        width: 90%;
        max-width: 600px;
        padding: 20px;
        border-radius: 12px;
        background: rgba(255,255,255,0.03);
        box-shadow: 0 0 10px rgba(0,255,100,0.2);
    }

    select {
        padding: 8px;
        border-radius: 8px;
        background: #111;
        color: white;
        border: 1px solid #333;
        margin-right: 10px;
    }
    body.light select {
        background: white;
        color: black;
    }

    .btn {
        width: 100%;
        padding: 14px;
        margin-top: 15px;
        background: #0aff64;
        border: none;
        border-radius: 10px;
        font-weight: bold;
        color: #003300;
        font-size: 17px;
        cursor: pointer;
        transition: 0.2s;
        box-shadow: 0 0 20px #00ff80;
    }

    .stopBtn {
        background: #ff4d4d;
        box-shadow: 0 0 12px #ff4d4d;
        margin-top: 10px;
        display: none;
    }

    #messages {
        height: 350px;
        overflow-y: auto;
        margin-top: 20px;
        padding: 10px;
        border-radius: 12px;
        background: rgba(0,0,0,0.35);
    }

    .msg {
        padding: 10px 14px;
        margin: 10px 0;
        max-width: 70%;
        border-radius: 14px;
        animation: fade 0.2s ease;
    }

    .me {
        background: #0aff64cc;
        margin-left: auto;
    }

    .him {
        background: #333333cc;
        margin-right: auto;
    }

    @keyframes fade {
        from {opacity:0; transform:translateY(4px);}
        to {opacity:1; transform:translateY(0);}
    }

    #typing {
        margin-top: 7px;
        opacity: 0.7;
        display: none;
    }

    .input-box {
        display: none;
        margin-top: 15px;
        display: flex;
        gap: 10px;
    }

    input {
        flex-grow: 1;
        padding: 10px;
        border-radius: 8px;
        border: none;
        background: #111;
        color: white;
    }
    body.light input {
        background: #efefef;
        color: black;
    }

</style>

</head>
<body>

<div class="top">
    <div class="logo">
        <div class="logo-icon">RC</div>
        <div class="logo-text">Ruslan Chat</div>
    </div>
    <button class="themeBtn" id="themeBtn">Тема</button>
</div>

<div class="panel">
    <div id="onlineTxt">Онлайн: 0</div>

    <select id="myGender">
        <option>Мужчина</option>
        <option>Женщина</option>
    </select>

    <select id="searchGender">
        <option>Ищу любой</option>
        <option>Ищу мужчину</option>
        <option>Ищу женщину</option>
    </select>

    <button class="btn" id="findBtn">НАЙТИ СОБЕСЕДНИКА</button>
    <button class="btn stopBtn" id="stopBtn">Прекратить поиск</button>

    <div id="messages"></div>
    <div id="typing">Собеседник печатает...</div>

    <div class="input-box" id="inputBox">
        <input type="text" id="msgInput" placeholder="Введите сообщение..." disabled>
        <button class="btn" id="sendBtn" style="width:150px;">Отправить</button>
    </div>
</div>

<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
<script>
const socket = io();
let inChat = false;

const findBtn = document.getElementById("findBtn");
const stopBtn = document.getElementById("stopBtn");
const msgInput = document.getElementById("msgInput");
const sendBtn = document.getElementById("sendBtn");
const inputBox = document.getElementById("inputBox");
const typing = document.getElementById("typing");
const messages = document.getElementById("messages");

function addMsg(text, me=false) {
    let d = document.createElement("div");
    d.className = "msg " + (me ? "me" : "him");
    d.innerText = text;
    messages.appendChild(d);
    messages.scrollTop = messages.scrollHeight;
}

function resetUI() {
    inChat = false;
    inputBox.style.display = "none";
    msgInput.disabled = true;
    sendBtn.disabled = true;
    stopBtn.style.display = "none";
    findBtn.style.display = "block";
    typing.style.display = "none";
}

document.getElementById("themeBtn").onclick = () => {
    document.body.classList.toggle("light");
    localStorage.setItem("theme", document.body.classList.contains("light") ? "light" : "dark");
};

if (localStorage.getItem("theme") === "light") {
    document.body.classList.add("light");
}

findBtn.onclick = () => {
    findBtn.style.display = "none";
    stopBtn.style.display = "block";
    socket.emit("find", {
        gender: myGender.value,
        search: searchGender.value
    });
};

stopBtn.onclick = () => {
    socket.emit("stop");
    resetUI();
};

sendBtn.onclick = send;
msgInput.addEventListener("keydown", e => {
    if (e.key === "Enter") send();
});

function send() {
    if (!msgInput.value.trim()) return;
    socket.emit("msg", msgInput.value);
    addMsg(msgInput.value, true);
    msgInput.value = "";
}

msgInput.addEventListener("input", () => {
    if (inChat) socket.emit("typing");
});

socket.on("online", n => {
    onlineTxt.innerText = "Онлайн: " + n;
});

socket.on("found", () => {
    inChat = true;
    inputBox.style.display = "flex";
    msgInput.disabled = false;
    sendBtn.disabled = false;
});

socket.on("typing", () => {
    typing.style.display = "block";
    clearTimeout(window.tt);
    window.tt = setTimeout(() => typing.style.display = "none", 1000);
});

socket.on("msg", txt => {
    addMsg(txt, false);
});

socket.on("end", () => {
    addMsg("Собеседник отключился.");
    resetUI();
});
</script>

</body>
</html>
