<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Ruslan Chat</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --accent:#6a4cff;
  --bg:#0b0b0f;
  --block:#15151b;
  --text:#eee;
}

body{
  margin:0;
  padding:0;
  background:var(--bg);
  color:var(--text);
  font-family:Arial, sans-serif;
}

.container{
  width:100%;
  max-width:450px;
  margin:40px auto;
  text-align:center;
}

/* LOGO */
.logo{
  font-size:36px;
  font-weight:900;
  color:var(--accent);
  margin-bottom:20px;
  text-shadow:0 0 25px var(--accent);
  animation:fadeIn 1s ease;
}

@keyframes fadeIn{
  from{opacity:0; transform:translateY(-10px);}
  to{opacity:1; transform:translateY(0);}
}

select,input{
  width:100%;
  padding:14px;
  font-size:16px;
  margin-top:12px;
  border:none;
  border-radius:10px;
  background:var(--block);
  color:white;
  outline:none;
  transition:0.3s;
  box-shadow:0 0 0 rgba(0,0,0,0);
}

select:focus,input:focus{
  box-shadow:0 0 12px var(--accent);
}

/* BUTTONS */
.btn{
  width:100%;
  padding:14px;
  margin-top:15px;
  background:var(--accent);
  border:none;
  border-radius:50px;
  color:#fff;
  font-size:18px;
  cursor:pointer;
  font-weight:bold;
  transition:0.25s;
  box-shadow:0 0 15px rgba(106,76,255,0.6);
}

.btn:hover{
  filter:brightness(1.15);
  transform:scale(1.03);
}

/* CHAT AREA */
#chat{
  display:none;
  animation:fadeIn 0.6s;
}

#messages{
  height:340px;
  overflow-y:auto;
  border-radius:10px;
  padding:10px;
  margin-bottom:10px;
  background:var(--block);
  box-shadow:0 0 15px rgba(0,0,0,0.4);
}

.message{
  background:#1f1f27;
  margin:8px 0;
  padding:12px;
  border-radius:10px;
  text-align:left;
  font-size:15px;
  animation:fadeInMsg 0.3s;
}

@keyframes fadeInMsg{
  from{opacity:0; transform:translateY(5px);}
  to{opacity:1; transform:translateY(0);}
}

/* ROULETTE */
.loader{
  margin-top:20px;
  display:none;
}

.spinner{
  width:60px;
  height:60px;
  border:6px solid #333;
  border-top-color:var(--accent);
  border-radius:50%;
  animation:spin 1s linear infinite;
  margin:0 auto;
}

@keyframes spin{
  to{transform:rotate(360deg);}
}

/* ONLINE COUNTER */
.online{
  margin-top:10px;
  font-size:15px;
  opacity:0.8;
}

</style>
</head>

<body>

<div class="container">

  <div class="logo">RUSLAN CHAT üí¨</div>

  <div class="online" id="onlineCount">–í —Å–µ—Ç–∏: 0</div>

  <div id="menu">

      <select id="myGender">
        <option value="m">–Ø ‚Äî –º—É–∂—á–∏–Ω–∞</option>
        <option value="f">–Ø ‚Äî –∂–µ–Ω—â–∏–Ω–∞</option>
      </select>

      <select id="seekGender">
        <option value="a">–ò—â—É ‚Äî –ª—é–±–æ–π</option>
        <option value="m">–ò—â—É ‚Äî –º—É–∂—á–∏–Ω—É</option>
        <option value="f">–ò—â—É ‚Äî –∂–µ–Ω—â–∏–Ω—É</option>
      </select>

      <button class="btn" onclick="startSearch()">–ù–∞–π—Ç–∏ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞</button>

      <div class="loader" id="loader">
         <div class="spinner"></div>
         <div style="margin-top:10px;">–ü–æ–∏—Å–∫...</div>
      </div>

  </div>

  <div id="chat">
      <div id="messages"></div>
      <input id="msgInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...">
      <button class="btn" onclick="sendMsg()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      <button class="btn" onclick="endChat()">–û—Ç–∫–ª—é—á–∏—Ç—å—Å—è</button>
  </div>

</div>

<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script>
const socket = io();
let roomId = null;

const menu = document.getElementById("menu");
const chat = document.getElementById("chat");
const messagesEl = document.getElementById("messages");
const msgInput = document.getElementById("msgInput");
const loader = document.getElementById("loader");
const onlineCount = document.getElementById("onlineCount");

socket.on("online_count", n=>{
  onlineCount.innerText = "–í —Å–µ—Ç–∏: " + n;
});

function startSearch(){
  loader.style.display="block";

  const myGender = document.getElementById("myGender").value;
  const seekGender = document.getElementById("seekGender").value;

  socket.emit("join_queue", {
    myGender,
    seekingGender: seekGender
  });

  menu.style.display="none";
}

socket.on("matched", data => {
  roomId = data.roomId;
  loader.style.display="none";
  chat.style.display="block";
});

function sendMsg(){
  if(!msgInput.value.trim()) return;
  socket.emit("message", { roomId, text: msgInput.value });
  addMsg("–í—ã: " + msgInput.value);
  msgInput.value="";
}

socket.on("message", data => {
  addMsg("–°–æ–±–µ—Å–µ–¥–Ω–∏–∫: " + data.text);
});

function addMsg(t){
  const div = document.createElement("div");
  div.className="message";
  div.innerText=t;
  messagesEl.appendChild(div);
  messagesEl.scrollTop = messagesEl.scrollHeight;
}

function endChat(){
  if(roomId) socket.emit("end", { roomId });
  roomId=null;
  chat.style.display="none";
  menu.style.display="block";
}

socket.on("ended", ()=>{
  alert("–°–æ–±–µ—Å–µ–¥–Ω–∏–∫ –æ—Ç–∫–ª—é—á–∏–ª—Å—è");
  roomId=null;
  chat.style.display="none";
  menu.style.display="block";
});

socket.on("force_end_from_disconnect", ()=>{
  if(roomId){
    alert("–°–æ–±–µ—Å–µ–¥–Ω–∏–∫ –≤—ã—à–µ–ª");
    roomId=null;
    chat.style.display="none";
    menu.style.display="block";
  }
});

window.onbeforeunload = () => {
  if(roomId) socket.emit("end", { roomId });
};
</script>
</body>
</html>
