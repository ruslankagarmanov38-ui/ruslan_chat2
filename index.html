<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Ruslan Chat</title>
<style>
    body {
        margin:0;
        font-family: Arial, sans-serif;
        background: #0d0d0d;
        color:white;
        transition: 0.4s;
    }

    body.light {
        background:white;
        color:black;
    }

    .header {
        display:flex;
        justify-content: space-between;
        align-items:center;
        padding:15px;
        font-size:20px;
        font-weight:600;
    }

    .theme-btn {
        cursor:pointer;
        padding:5px 14px;
        border-radius:6px;
        background:#222;
        transition:.3s;
    }

    body.light .theme-btn {
        background:#ddd;
        color:black;
    }

    .container {
        width:420px;
        margin: auto;
        margin-top:20px;
    }

    select {
        width:49%;
        padding:10px;
        border-radius:6px;
        border:none;
        margin-bottom: 15px;
        background:#1b1b1b;
        color:white;
        outline:none;
    }
    body.light select {
        background:#eee;
        color:black;
    }

    #findBtn {
        width:100%;
        padding:13px;
        border:none;
        border-radius:10px;
        background:#00ff7b;
        font-size:16px;
        cursor:pointer;
        font-weight:700;
        box-shadow:0 0 15px #00ff7b88;
        transition:.25s;
    }

    #stopBtn {
        display:none;
        width:100%;
        margin-top:10px;
        padding:13px;
        border:none;
        border-radius:10px;
        background:#ff5555;
        font-size:16px;
        cursor:pointer;
        font-weight:700;
        box-shadow:0 0 15px #ff444488;
        transition:.25s;
    }

    #spinner {
        display:none;
        text-align:center;
        margin:10px 0;
        font-size:18px;
        opacity:0.7;
    }

    #chat {
        width:100%;
        height:380px;
        margin-top:15px;
        padding:10px;
        overflow-y:auto;
        background:#0f0f0f;
        border-radius:10px;
        box-shadow: inset 0 0 10px #000;
    }

    body.light #chat {
        background:#fafafa;
        box-shadow: inset 0 0 10px #ccc;
    }

    .msg {
        padding:8px 12px;
        margin:8px 0;
        max-width:80%;
        border-radius:12px;
        animation: pop .25s ease;
    }

    @keyframes pop { from { transform:scale(.8); opacity:0;} }

    .me {
        background:#0084ff;
        align-self:flex-end;
        color:white;
        margin-left:auto;
    }

    .other {
        background:#2b2b2b;
    }

    body.light .other { background:#ddd; color:black; }

    .input-box {
        display:flex;
        gap:10px;
        margin-top:10px;
    }

    #msgInput {
        flex:1;
        padding:10px;
        border-radius:8px;
        border:none;
    }

    #sendBtn {
        padding:10px 16px;
        background:#00ff7b;
        border:none;
        border-radius:8px;
        cursor:pointer;
    }
</style>
</head>
<body>

<div class="header">
    Ruslan Chat
    <div class="theme-btn" id="themeBtn">Тема</div>
</div>

<div class="container">

    <div id="online">Онлайн: 0</div>

    <select id="gender">
        <option>Мужчина</option>
        <option>Женщина</option>
    </select>

    <select id="looking">
        <option>Ищу любой</option>
        <option>Ищу мужчину</option>
        <option>Ищу женщину</option>
    </select>

    <button id="findBtn">НАЙТИ СОБЕСЕДНИКА</button>
    <button id="stopBtn">Прекратить поиск</button>

    <div id="spinner">⏳ Поиск...</div>

    <div id="chat"></div>

    <div class="input-box">
        <input id="msgInput" placeholder="Введите сообщение..." disabled>
        <button id="sendBtn" disabled>Отправить</button>
    </div>

</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
let inChat = false;

document.getElementById("themeBtn").onclick = () =>
{
    document.body.classList.toggle("light");
};

socket.on("online_count", n=>{
    document.getElementById("online").innerText = "Онлайн: " + n;
});

document.getElementById("findBtn").onclick = ()=>{
    socket.emit("find", {
        gender: gender.value,
        looking: looking.value
    });

    spinner.style.display="block";
    stopBtn.style.display="block";
    findBtn.style.display="none";
};

document.getElementById("stopBtn").onclick = ()=>{
    socket.emit("stop");
    resetUI();
};

socket.on("found",()=>{
    inChat = true;
    spinner.style.display="none";
    msgInput.disabled = false;
    sendBtn.disabled = false;
});

socket.on("partner_left",()=>{
    if (!inChat) return;
    add("Собеседник отключился");
    inChat=false;
    resetUI();
});

function resetUI(){
    findBtn.style.display="block";
    stopBtn.style.display="none";
    spinner.style.display="none";
    msgInput.disabled=true;
    sendBtn.disabled=true;
}

sendBtn.onclick = send;

msgInput.addEventListener("keydown", e=>{
    if(e.key==="Enter") send();
});

function send(){
    let t = msgInput.value.trim();
    if(!t) return;

    addMy(t);
    socket.emit("msg", t);
    msgInput.value="";
}

socket.on("msg", t=>{
    addOther(t);
});

function addMy(t){
    addMsg("me", t);
}

function addOther(t){
    addMsg("other", t);
}

function addMsg(type, text){
    let d = document.createElement("div");
    d.className = "msg "+type;
    d.innerText = text;
    chat.appendChild(d);
    chat.scrollTop = chat.scrollHeight;
}

function add(text){
    let d = document.createElement("div");
    d.style.opacity=0.7;
    d.innerText = text;
    chat.appendChild(d);
}
</script>
</body>
</html>

